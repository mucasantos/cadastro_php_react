<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste Dashboard Simples</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .card { margin: 10px; }
        .debug { background: #f8f9fa; padding: 15px; margin: 10px 0; border-radius: 5px; }
    </style>
</head>
<body>
    <div class="container mt-4">
        <h1>🧪 Teste Dashboard Simples</h1>
        
        <div class="debug">
            <h4>Status do Teste:</h4>
            <div id="status">Iniciando...</div>
        </div>

        <!-- Cards de Teste (igual ao dashboard real) -->
        <div class="row">
            <div class="col-md-3">
                <div class="card bg-primary text-white">
                    <div class="card-body">
                        <h4 id="totalClientes">0</h4>
                        <p>Total Clientes</p>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card bg-success text-white">
                    <div class="card-body">
                        <h4 id="totalProdutos">0</h4>
                        <p>Total Produtos</p>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card bg-info text-white">
                    <div class="card-body">
                        <h4 id="clientesAtivos">0</h4>
                        <p>Clientes Ativos</p>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card bg-warning text-white">
                    <div class="card-body">
                        <h4 id="produtosAtivos">0</h4>
                        <p>Produtos Ativos</p>
                    </div>
                </div>
            </div>
        </div>

        <button class="btn btn-primary mt-3" onclick="loadDashboard()">Carregar Dashboard</button>
        <button class="btn btn-secondary mt-3" onclick="testAPIs()">Testar APIs</button>
    </div>

    <script>
        function updateStatus(message) {
            document.getElementById('status').innerHTML += '<br>' + message;
            console.log(message);
        }

        async function testAPIs() {
            updateStatus('🔍 Testando APIs...');
            
            try {
                // Teste API Clientes
                updateStatus('📞 Chamando API de clientes...');
                const clientesResponse = await fetch('api/clientes/read.php');
                updateStatus(`📊 API Clientes: ${clientesResponse.status} ${clientesResponse.statusText}`);
                
                if (clientesResponse.ok) {
                    const clientesData = await clientesResponse.json();
                    updateStatus(`✅ Clientes recebidos: ${JSON.stringify(clientesData).substring(0, 100)}...`);
                }

                // Teste API Produtos
                updateStatus('📞 Chamando API de produtos...');
                const produtosResponse = await fetch('api/produtos/read.php');
                updateStatus(`📊 API Produtos: ${produtosResponse.status} ${produtosResponse.statusText}`);
                
                if (produtosResponse.ok) {
                    const produtosData = await produtosResponse.json();
                    updateStatus(`✅ Produtos recebidos: ${JSON.stringify(produtosData).substring(0, 100)}...`);
                }

            } catch (error) {
                updateStatus(`❌ Erro: ${error.message}`);
            }
        }

        async function loadDashboard() {
            updateStatus('🚀 Carregando dashboard...');
            
            try {
                updateStatus('📡 Fazendo requisições paralelas...');
                
                const [clientesResponse, produtosResponse] = await Promise.all([
                    fetch('api/clientes/read.php'),
                    fetch('api/produtos/read.php')
                ]);

                let totalClientes = 0, totalProdutos = 0, clientesAtivos = 0, produtosAtivos = 0;

                // Processar clientes
                if (clientesResponse.ok) {
                    const clientesData = await clientesResponse.json();
                    const clientes = Array.isArray(clientesData) ? clientesData : (clientesData.records || []);
                    totalClientes = clientes.length;
                    clientesAtivos = clientes.filter(c => c.status === 'ativo').length;
                    updateStatus(`✅ Clientes: ${totalClientes} total, ${clientesAtivos} ativos`);
                } else {
                    updateStatus(`❌ Erro clientes: ${clientesResponse.status}`);
                }

                // Processar produtos
                if (produtosResponse.ok) {
                    const produtosData = await produtosResponse.json();
                    const produtos = Array.isArray(produtosData) ? produtosData : (produtosData.records || []);
                    totalProdutos = produtos.length;
                    produtosAtivos = produtos.filter(p => p.status === 'ativo').length;
                    updateStatus(`✅ Produtos: ${totalProdutos} total, ${produtosAtivos} ativos`);
                } else {
                    updateStatus(`❌ Erro produtos: ${produtosResponse.status}`);
                }

                // Atualizar elementos
                updateStatus('🔄 Atualizando elementos DOM...');
                
                const elements = {
                    'totalClientes': totalClientes,
                    'totalProdutos': totalProdutos,
                    'clientesAtivos': clientesAtivos,
                    'produtosAtivos': produtosAtivos
                };

                for (const [elementId, value] of Object.entries(elements)) {
                    const element = document.getElementById(elementId);
                    if (element) {
                        element.textContent = value;
                        updateStatus(`✅ ${elementId}: ${value}`);
                    } else {
                        updateStatus(`❌ Elemento ${elementId} não encontrado`);
                    }
                }

                updateStatus('🎉 Dashboard carregado com sucesso!');

            } catch (error) {
                updateStatus(`❌ Erro no dashboard: ${error.message}`);
            }
        }

        // Executar teste automático quando a página carregar
        window.addEventListener('load', () => {
            updateStatus('✅ Página carregada');
            updateStatus('🔍 Verificando elementos DOM...');
            
            const elements = ['totalClientes', 'totalProdutos', 'clientesAtivos', 'produtosAtivos'];
            elements.forEach(elementId => {
                const element = document.getElementById(elementId);
                if (element) {
                    updateStatus(`✅ Elemento ${elementId} encontrado`);
                } else {
                    updateStatus(`❌ Elemento ${elementId} NÃO encontrado`);
                }
            });
            
            // Carregar dashboard automaticamente
            setTimeout(() => {
                loadDashboard();
            }, 1000);
        });
    </script>
</body>
</html>